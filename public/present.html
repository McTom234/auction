<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" href="index.css" />
    <title>Auktion – Admin</title>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <div class="navbar navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand">Auktion – Admin</a>
        <span class="navbar-text">
          Nutzer online: <span id="online"></span>
        </span>
      </div>
    </div>
    <div id="content" class="container fluid mt-2">
      <div id="lobby" style="display: none" class="">
        Die Auktion wurde noch nicht gestartet <br  />
        <button class="btn btn-primary mt-2" id="button-start">
          Auktion starten
        </button>
      </div>
      <div id="started" style="display: none">
        <div class="mb-3 row">
          <span class="col-sm-2">Aktuelles Gebot: </span>
          <span class="col-sm-2" id="preis"></span>
        </div>
        <div class="mb-3 row">
          <span class="col-sm-2">Produkt: </span>
          <div class="col-sm-2" >
            <span id="name"></span> <img id="image" class="rounded"/></div> 
        </div>
        
        <button class="btn btn-primary" id="button-next">
          Nächstes Produkt
        </button>
        <table class="table mt-2">
          <thead>
            <th>Uhrzeit</th>
            <th>Nutzername</th>
            <th>Gebot</th>
          </thead>
          <tbody id="history"></tbody>
        </table>
      </div>
      <div id="over" style="display: none">
        Die Auktion ist beendet. <br  />
        <button class="btn btn-primary mt-2" id="button-restart">
          Auktion neu starten
        </button>
      </div>
      <div id="error" style="display: none">
        <div class="alert alert-danger"> Es ist ein Fehler aufgetreten.</div>
      </div>
    </div>
    <script src="index.js"></script>

    <script>
      var socket = connectSocket("presenter");

      socket.on("price", (msg) => {
        const el = document.getElementById("preis");
        el.innerHTML = msg;
      });
      socket.on("product", (msg) => {
        const el = document.getElementById("name");
        el.innerHTML = msg.name;
        const img = document.getElementById("image");
        img.setAttribute("src", msg.image);
      });
      socket.on("user-count", (msg)=>{
        document.getElementById("online").innerHTML = msg;
      });

      socket.on("history", (msg) => {
        const table = document.getElementById("history");

        if (msg.reset) {
          table.innerHTML = "";
        }
        for (const event of msg.payload) {
          const tr = document.createElement("tr");
          for (const value of [event.date, event.name, event.value]) {
            const td = document.createElement("td");
            td.innerText = value;
            tr.appendChild(td);
          }
          table.appendChild(tr);
        }
      });
      const startButton = document.getElementById("button-start");
      startButton.addEventListener("click", () => {
        socket.emit("start");
      });
      const nextButton = document.getElementById("button-next");
      nextButton.addEventListener("click", () => {
        socket.emit("next-product");
      });
      const restartButton = document.getElementById("button-restart");
      restartButton.addEventListener("click", () => {
        socket.emit("start");
      });
    </script>
    <script src="index.js"></script>
  </body>
</html>
